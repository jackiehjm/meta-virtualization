From 8fba7751f61a20158fedc3fc69684e9fe8cd0dce Mon Sep 17 00:00:00 2001
From: Marcus Watts <mwatts@redhat.com>
Date: Tue, 29 Jan 2019 02:48:29 -0500
Subject: [PATCH] Fix file descriptor leak.

If the openssl initial negotiation fails, then the rest of
what sslize does doesn't happen.  One of the last things
sslize does is to close the socket at the end of the session.
That needs to happen even if there's no session.

Signed-off-by: Marcus Watts <mwatts@redhat.com>
---
 src/civetweb/src/civetweb.c |    3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/civetweb/src/civetweb.c b/src/civetweb/src/civetweb.c
index d0ee84d..f950aeb 100644
--- a/src/civetweb/src/civetweb.c
+++ b/src/civetweb/src/civetweb.c
@@ -16252,6 +16252,9 @@ worker_thread_run(struct worker_thread_args *thread_args)
 					conn->request_info.client_cert = 0;
 				}
 			}
+			else {
+				close_connection(conn);
+			}
 #endif
 		} else {
 			/* process HTTP connection */
-- 
1.7.9.5

